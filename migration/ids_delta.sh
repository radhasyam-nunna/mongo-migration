#update mongoUri, user-name and password

collectionName="invoice"
dbName="refurb-service"

dir="/mnt/disk-1/mdb/$collectionName"
filter='['1088318349', '1088232993', '1088052405', '1088240871', '1087961049', '1087972996', '1088305245', '1088179206', '1088182099', '1088340270', '1088220276', '1088544541', '1088090649', '1088633864', '1088675449', '1088578341', '1088951106', '1089009821', '1088554861', '1088605377', '1089168502', '1089307035', '1088496230', '1088632925', '1088665599', '1088614054', '1089155933', '1088207175', '1089137173', '1088672856', '1088955966', '1088557022', '1089127539', '1088659763', '1088638984', '1088484965', '1088124386', '1088674658', '1088105006', '1088662026', '1089142438', '1088660764', '1088634939', '1089284338', '1089101743', '1088639650', '1088644086', '1088447063', '1088667220', '1088386290', '1088629145', '1088657125', '1088420644', '1088995048', '1088995855', '1088586038', '1088855468', '1089022363', '1088679014', '1088140458', '1089178942', '1089303149', '1089272440', '1089028394', '1088453374', '1088435999', '1089078719', '1088446477', '1089151968', '1088569588', '1088672802', '1088425064', '1088639993', '1088584594', '1089180086', '1088641446', '1089002490', '1089133789', '1088205761', '1088987669', '1088623316', '1088531489', '1088510203', '1089385535', '1089324996', '1089532416', '1089541113', '1088212394', '1089444013', '1088684904', '1089381438', '1089451216', '1089482471', '1089512919', '1088435101', '1089362010', '1089785830', '1089247093', '1089427724', '1089491568', '1089155400', '1088672544', '1089906791', '1089873339', '1089534983', '1089374949', '1089862840', '1089509637', '1089238907', '1089437650', '1089524528', '1089379961', '1089356893', '1089233303', '1089371557', '1089320343', '1089243170', '1089337572', '1089527119', '1089478360', '1089477490', '1089341629', '1089290050', '1089233402', '1089497275', '1089508270', '1089445128', '1088477858', '1089543021', '1088235490', '1089795342', '1089534659', '1089504388', '1089136388', '1089542461', '1089543958', '1089414231', '1089477234', '1088482078', '1089517690', '1089467820', '1089491036', '1089071352', '1089405325','1089938539', '1089963716', '1089718653', '1090146935', '1090286774', '1090389156', '1089718191', '1090400806', '1090403304', '1090243285', '1090380998', '1090387252', '1090046359', '1090624216', '1089331900', '1089438587', '1089540630', '1088514493', '1089416900', '1090158719', '1090350530', '1090267401', '1089108002', '1090422234', '1089326482', '1090198756', '1090197416', '1090022511', '1090336327', '1090304782', '1090362987', '1089934974', '1090112053', '1090374181', '1088594252', '1088636608', '1088367618', '1088001556', '1089746588', '1090067652', '1090129680', '1090248065', '1090364606', '1089134206', '1090250080', '1088686349', '1089256250', '1089792708', '1090165383', '1089807479', '1089986402', '1089522186', '1090094138', '1090136833', '1090056444', '1090388091', '1089317383', '1089401142', '1089858656', '1090053117', '1090606489', '1089940417', '1090379746', '1090234260', '1088524567', '1090389699', '1090410884', '1088206011', '1090023402', '1090407163', '1089932300', '1090021389', '1090341166', '1090138134', '1090419330', '1090368823', '1089998899', '1090088993', '1089946463', '1089140584', '1090401093', '1090406393', '1090349640', '1090315948', '1090173457', '1089963310', '1090396190', '1089236597', '1091180996', '1091263973', '1091249906', '1090765046', '1091258948', '1088642971', '1090848720', '1090894340', '1091208586', '1091026085', '1091079446', '1091211765', '1091264828', '1091232244', '1090809824', '1090966788', '1091247180', '1089373393', '1089963036', '1090989962', '1090123342', '1091245637', '1091096552', '1091060365', '1091294477', '1091142033', '1091092352', '1090729640', '1090925627', '1088400619', '1090800748', '1091128957', '1088654101', '1091289576', '1089122842', '1091183204', '1090839109', '1091281078', '1091294564', '1090774177', '1091053627', '1089403937', '1090972173', '1091017891', '1090957509', '1090207346', '1090344938', '1091125950', '1090835399', '1090970361', '1091141870', '1091295372', '1091152733', '1090974119', '1090991729', '1090725148', '1090844378', '1090946343', '1088671479', '1090882486', '1091072056', '1091131726', '1091284082', '1090950589', '1091119637', '1090998112', '1091235147', '1091195711', '1091147001', '1090970771', '1090950242', '1091292384', '1091240251', '1090971518', '1090031017', '1090965940', '1090974634', '1091283700', '1091292293', '1090904366', '1091015854', '1091111713', '1091107964', '1090754824', '1089532380', '1091264329', '1091244071', '1090943499', '1089487268', '1091227989', '1091116562', '1091284869', '1091281307', '1091257267', '1090804944', '1090857937', '1091285409', '1091599924', '1091723555', '1091300845', '1091562808', '1091268358', '1091496093', '1091630247', '1091751268', '1091298510', '1091639391', '1091668437', '1091716954', '1091563686', '1091682021', '1091698425', '1091522338', '1091287863', '1091226798', '1091750973', '1091553541', '1091712118', '1091613428', '1091205213', '1091631816', '1091546327', '1091728344', '1091746007', '1091702245', '1091288702', '1091157091', '1091296100', '1091725703', '1091632743', '1091580226', '1091629092', '1091704155', '1091422371', '1091714341', '1091676155']'
mongoUri="****"
echo "Using collection: $collectionName | database: $dbName | URI: $mongoUri" 
echo "filter: $filter"


sudo docker run -v /mnt/disk-1:/mnt/disk-1/ arangodb/arangodb:3.10.10 \
  arangoexport \
  --server.endpoint ssl://172.16.2.12:8529 \
  --server.database "$dbName"-in \
  --server.username user-name \
  --server.password password \
  --custom-query "FOR doc IN $collectionName FILTER doc._key in $filter LET docKey = doc._key RETURN MERGE(UNSET(doc, '_id','_rev','_class','_key'), { _id: docKey })" \
  --type json \
  --output-directory "$dir" \
  --overwrite true \
  --documents-per-batch 300 \
  --progress true


# dir="/mnt/disk-1/mdb/$collectionName"
mongoimport --uri "$mongoUri" \
  --db "$dbName" \
  --collection "$collectionName" \
  --file "$dir/query.json" \
  --jsonArray \
  --upsert \
  --numInsertionWorkers=8

echo "started date conversion script"
curl --location "http://localhost:7091/test/migrate/$dbName/$testCollectionName?applyDateFilter=true"
